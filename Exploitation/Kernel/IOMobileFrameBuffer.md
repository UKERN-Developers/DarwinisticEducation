# IOMobileFrameBuffer

## About IOMobileFrameBuffer
IOMobileFrameBuffer (IOMBF) is a kernel driver used for managing the screen's framebuffers.  
Apple Inc. has not disclosed the driver's sourcecode but it was used in known kernel exploits by for example reknown Chinese research team PanGu.

| Selector 	| Action                  	| Input                                                                                            	| Output                                	|
|----------	|-------------------------	|--------------------------------------------------------------------------------------------------	|---------------------------------------	|
| 3        	| getDefaultSurface       	|                                                                                                  	| IOSurfaceID  surfaceID                	|
| 4        	| swapBegin               	|                                                                                                  	| IOMobileFramebufferSwapID swapID      	|
| 5        	| swapEnd                 	| struct IOMobileFramebufferSwapArg                                                                	|                                       	|
| 6        	| swapWait                	| IOMobileFramebufferSwapID  swapID, uint32_t waitOptions, (iOS 4.2+ only) uint64_t timeout_millis 	|                                       	|
| 7        	| getId                   	|                                                                                                  	| IOSwapNotificationID framebufferID    	|
| 8        	| getDisplaySize          	|                                                                                                  	| struct IOMobileFramebufferDisplaySize 	|
| 9        	| setVSyncNotifications   	| size_t functionAddress (if 0, notification is disabled), size_t userData                         	|                                       	|
| 12       	| requestPowerChange      	| uint32_t value                                                                                   	|                                       	|
| 15       	| setDebugFlags           	| uint32_t ???[2]                                                                                  	| uint32_t ???                          	|
| 17       	| setGammaTable           	| struct IOMobileFramebufferGammaTables                                                            	|                                       	|
| 18       	| isMainDisplay           	|                                                                                                  	| uint32_t result                       	|
| 19       	| setWhiteOnBlackMode     	| uint32_t value                                                                                   	|                                       	|
| 22       	| setDisplayDevice        	| uint32_t value                                                                                   	|                                       	|
| 27       	| getGammaTable           	|                                                                                                  	| struct IOMobileFramebufferGammaTables 	|
| 33       	| setVideoPowerSaving     	| uint32_t value                                                                                   	|                                       	|
| 50       	| setBrightnessCorrection 	| uint32_t value                                                                                   	|                                       	|

(*Source: https://iphonedevwiki.net/index.php/IOMobileFramebuffer*)


## Use Cases

### GoodNight
GoodNight is a tweak for both jailbroken and non-jailbroken iPhones that lets you control the gamma of your iPhone's screen.  
GoodNight is a successor to Flux, an app that Apple later implemented the features of in their operating system which we now know as Nightshift.  
GoodNight is like NightShift but let's you set the gamma to any color you desire.  
It uses the IOMobileFrameBufferSetGammaTable feature to set the gamma of the screen's framebuffer.  
*Source: https://github.com/anthonya1999/GoodNight/blob/master/GoodNight/IOMobileFramebufferClient.m*)

## Bugs and mitigations


### iOS 11.4.1
**Available for**: iPhone 5s and later, iPad Air and later, and iPod touch 6th generation.  
**Impact**: An application may be able to read restricted memory.  
**Description**: A validation issue was addressed with improved input sanitization.  
**CVE**: CVE-2018-4335.  
**Author**: Brandon Azad. 

### iOS 11.1.2
**Available for**: iPhone 5s and later, iPad Air and later, and iPod touch 6th generation.  
**Impact**: An application may be able to execute arbitrary code with kernel privileges.  
**Description**: A memory corruption issue was addressed with improved memory handling.  
**CVE**: CVE-2017-13879.  
**Author**: Apple.

### iOS 9.3.3
**Available for**: iPhone 4s and later, iPad 2 and later, iPod touch (5th generation) and later.  
**Impact**: An application may be able to execute arbitrary code with kernel privileges.  
**Description**: A memory corruption issue was addressed through improved memory handling.  
**CVE**: CVE-2016-4654  
**Author**: Team Pangu  
**Writeup**: http://newosxbook.com/articles/nuwashi.pdf  


### iOS 8.2
**Available for**: iPhone 4s and later, iPod touch (5th generation) and later, iPad 2 and later.   
**Impact**: A malicious application may be able to determine kernel memory layout.  
**Description**: An issue existed in MobileFrameBuffer that led to the disclosure of kernel memory content. This issue was addressed through improved bounds checking.  
**CVE**: CVE-2015-1097.  
**Author**: Barak Gabai of the IBM X-Force Application Security Research Team.  
